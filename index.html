
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="ja">
<head>
  <!-- 「Generated_by_TilesXYZ」を改変 -->
  <title>メッシュ平年値データ地図(オフライン版) </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="utf-8" />
  <link rel="stylesheet" href="./leaflet/leaflet.css">
  <script src="./leaflet/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/leaflet-search@3.0.2/dist/leaflet-search.min.js"></script>
  <link rel="stylesheet" href="./leaflet-search/leaflet-search.css">
  <script src="./leaflet-search/leaflet-search.js"></script>
  <script src="5137-5238.geojson"></script><!-- geojsonファイルのパスを指定（課題：複数ファイルの場合どうする？） -->
  <style type="text/css">
    body {
       margin: 0;
       padding: 0;
    }
    html, body, #map{
       width: 100%;
       height: 100%;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <script>
      var map = L.map('map').setView([35.0, 138.5], 10);
      L.tileLayer('Shizuoka512DPI/{z}/{x}/{y}.png', {
        //地理院地図タイルのパスを指定（ファイルサイズが大きい)
        minZoom: 5,
        maxZoom: 14,
        tms: false,
        attribution: '<br>背景図：国土地理院地図(Generated by TilesXYZ)<rr>「測量法に基づく国土地理院長承認（複製）R 6JHf 219」「本製品を複製する場合には、国土地理院の長の承認を得なければならない。」'
      }).addTo(map);

      var mesh= L.geoJSON(meshdata, {
          style: function(feature) {
           return {
            stroke: true,
            color: "blue",
            opacity: "0.5",
            weight: "1",
            fill: true,
            fillColor: "red",
            fillOpacity: "0.25",
            attribution: '<br>メッシュ気象：気象平年値(基盤数値情報) 使用条件は非商用に限る'
          }
        },
        onEachFeature: function (feature, layer) {
        layer.bindPopup(feature.properties.G02_001+'<br>' + '<a href="./xlsx/' + feature.properties.G02_001 + '.xlsx">xlsxファイル</a>');
        //geoJSONファイル内のメッシュコードから、メッシュ気象データの入ったxlsxファイルへのリンクを作成。
        //layer.bindTooltip(feature.properties.G02_001, {
        //  permanent: true,
        //  opacity: 0.7
        //}).openTooltip();
          //行けるけど描画遅すぎる。ズームしたい。
        }
      });
      mesh.addTo(map);

      //var labelLayer= L.geoJSON(meshdata, {
          //style: function(feature) {
           //return {
            //stroke: false,
            //fill: false,
          //}
        //},
        //onEachFeature: function (feature, layer) {
          //layer.bindTooltip(feature.properties.G02_001,{
            //permanent: false,
            //opacity: 0.7
          //})
        //}
      //});
      //labelLayer.addTo(map);

     //var visible;

    //map.on('zoomend', function (e) {
      //if (map.getZoom() > 8) {
        //if (!visible) {
          //labelLayer.eachLayer(function (layer) {
            //layer.showLabel();
          //});
          //visible = true;
        //}
      //} else {
        //if (visible) {
          //labelLayer.eachLayer(function (layer) {
            //layer.hideLabel();
          //});
          //visible = false;
        //}
      //}
    //});

    new L.control.search({
      layer: mesh,
      propertyName: "G02_001",
      textPlaceholder: "検索対象を入力",
      initial: false,
      //zoom: 10,
      marker: false,
      position: "topright"
    }).addTo(map)

  </script>
</body>
  <!-- 「　参考 https://note.com/ryoearth/n/n779386780fbb  -->
</html>

